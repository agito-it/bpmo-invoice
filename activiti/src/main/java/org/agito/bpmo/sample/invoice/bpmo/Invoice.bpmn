<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd" targetNamespace="http://www.activiti.org/test">
  <collaboration id="Collaboration">
    <participant id="InvoicePool" name="Invoice Pool" processRef="Invoice_InvoiceProcess"/>
  </collaboration>
  <process id="Invoice_InvoiceProcess" name="InvoiceProcess" isExecutable="true">
    <laneSet id="laneSet_VaadinDevelopmentDefinition1_InvoiceProcess">
      <lane id="postOffice" name="Mail Admin Center">
        <flowNodeRef>InvoicesProcessStartevent</flowNodeRef>
      </lane>
      <lane id="accounting" name="Financial Accounting">
        <flowNodeRef>CheckOrder</flowNodeRef>
      </lane>
      <lane id="approval" name="Approver">
        <flowNodeRef>Approval</flowNodeRef>
        <flowNodeRef>exclusivegateway1</flowNodeRef>
        <flowNodeRef>IsApprovedGateway</flowNodeRef>
      </lane>
      <lane id="TechnicalSystems" name="Technical Systems">
        <flowNodeRef>ResolveOrder</flowNodeRef>
        <flowNodeRef>IsOrderResovedgateWay</flowNodeRef>
        <flowNodeRef>servicetask1</flowNodeRef>
        <flowNodeRef>endevent1</flowNodeRef>
      </lane>
    </laneSet>
    <startEvent id="InvoicesProcessStartevent" name="Start">
      <outgoing>flow1</outgoing>
    </startEvent>
    <sequenceFlow id="flow1" sourceRef="InvoicesProcessStartevent" targetRef="ResolveOrder"/>
    <serviceTask id="ResolveOrder" activiti:async="true" activiti:exclusive="false" activiti:class="de.agito.cps.process.activiti.listener.ExecuteBPMOActionDelegate" name="Resolve Order">
      <extensionElements>
        <activiti:field name="action">
          <activiti:string>ResolveOrder</activiti:string>
        </activiti:field>
        <activiti:field name="variable">
          <activiti:string>IsResolved</activiti:string>
        </activiti:field>
        <activiti:field name="mode">
          <activiti:string>EDIT</activiti:string>
        </activiti:field>
      </extensionElements>
      <incoming>flow1</incoming>
      <outgoing>flow2</outgoing>
    </serviceTask>
    <exclusiveGateway id="IsOrderResovedgateWay" name="Is order resoved?" default="notResolved">
      <incoming>flow2</incoming>
      <outgoing>resolved</outgoing>
      <outgoing>notResolved</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="flow2" sourceRef="ResolveOrder" targetRef="IsOrderResovedgateWay"/>
    <sequenceFlow id="resolved" name="resolved" sourceRef="IsOrderResovedgateWay" targetRef="exclusivegateway1">
      <conditionExpression xsi:type="tFormalExpression">${IsResolved}</conditionExpression>
    </sequenceFlow>
    <userTask id="Approval" activiti:candidateUsers="${approver},${$cpsInitiator}" activiti:candidateGroups="roleAnyone" name="Approve invoice">
      <incoming>flow3</incoming>
      <outgoing>flow5</outgoing>
    </userTask>
    <sequenceFlow id="notResolved" name="not resolved" sourceRef="IsOrderResovedgateWay" targetRef="CheckOrder"/>
    <userTask id="CheckOrder" activiti:candidateUsers="${$cpsInitiator}" activiti:candidateGroups="roleAnyone" name="Check Order">
      <incoming>notResolved</incoming>
      <incoming>disapproved</incoming>
      <outgoing>flow4</outgoing>
    </userTask>
    <exclusiveGateway id="exclusivegateway1">
      <incoming>resolved</incoming>
      <incoming>flow4</incoming>
      <outgoing>flow3</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="flow3" sourceRef="exclusivegateway1" targetRef="Approval">
      <extensionElements>
        <activiti:executionListener class="de.agito.cps.process.activiti.listener.ExecuteBPMOActionListener" event="take">
          <activiti:field name="action">
            <activiti:string>GetApprover</activiti:string>
          </activiti:field>
          <activiti:field name="variable">
            <activiti:string>approver</activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow4" sourceRef="CheckOrder" targetRef="exclusivegateway1"/>
    <exclusiveGateway id="IsApprovedGateway" name="IsApproved?" default="disapproved">
      <incoming>flow5</incoming>
      <outgoing>disapproved</outgoing>
      <outgoing>approved</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="flow5" sourceRef="Approval" targetRef="IsApprovedGateway"/>
    <sequenceFlow id="disapproved" name="disapproved" sourceRef="IsApprovedGateway" targetRef="CheckOrder"/>
    <serviceTask id="servicetask1" activiti:class="de.agito.cps.process.activiti.listener.ExecuteBPMOActionDelegate" name="Service Task">
      <extensionElements>
        <activiti:field name="action">
          <activiti:string>BackendBooking</activiti:string>
        </activiti:field>
      </extensionElements>
      <incoming>approved</incoming>
      <outgoing>flow6</outgoing>
    </serviceTask>
    <endEvent id="endevent1" name="End">
      <incoming>flow6</incoming>
    </endEvent>
    <sequenceFlow id="flow6" sourceRef="servicetask1" targetRef="endevent1"/>
    <sequenceFlow id="approved" name="approved" sourceRef="IsApprovedGateway" targetRef="servicetask1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${$cpsChoiceIdApproval.equals("approved")}]]></conditionExpression>
    </sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_Collaboration">
    <bpmndi:BPMNPlane id="BPMNPlane_Collaboration" bpmnElement="Collaboration">
      <bpmndi:BPMNShape id="BPMNShape_InvoicePool" bpmnElement="InvoicePool" isHorizontal="false">
        <omgdc:Bounds height="668.0" width="771.0" x="10.0" y="10.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_postOffice" bpmnElement="postOffice" isHorizontal="false">
        <omgdc:Bounds height="167.0" width="751.0" x="30.0" y="10.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_accounting" bpmnElement="accounting" isHorizontal="false">
        <omgdc:Bounds height="167.0" width="751.0" x="30.0" y="177.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_approval" bpmnElement="approval" isHorizontal="false">
        <omgdc:Bounds height="167.0" width="751.0" x="30.0" y="344.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_TechnicalSystems" bpmnElement="TechnicalSystems" isHorizontal="false">
        <omgdc:Bounds height="167.0" width="751.0" x="30.0" y="511.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_InvoicesProcessStartevent" bpmnElement="InvoicesProcessStartevent">
        <omgdc:Bounds height="35.0" width="35.0" x="100.0" y="80.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="34.0" x="101.0" y="60.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ResolveOrder" bpmnElement="ResolveOrder">
        <omgdc:Bounds height="55.0" width="105.0" x="70.0" y="560.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_IsOrderResovedgateWay" bpmnElement="IsOrderResovedgateWay">
        <omgdc:Bounds height="40.0" width="40.0" x="220.0" y="568.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_Approval" bpmnElement="Approval">
        <omgdc:Bounds height="55.0" width="105.0" x="370.0" y="380.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_CheckOrder" bpmnElement="CheckOrder">
        <omgdc:Bounds height="55.0" width="105.0" x="190.0" y="220.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_exclusivegateway1" bpmnElement="exclusivegateway1">
        <omgdc:Bounds height="40.0" width="40.0" x="300.0" y="387.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_IsApprovedGateway" bpmnElement="IsApprovedGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="520.0" y="388.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="76.0" x="564.0" y="398.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_servicetask1" bpmnElement="servicetask1">
        <omgdc:Bounds height="55.0" width="105.0" x="490.0" y="561.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_endevent1" bpmnElement="endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="640.0" y="571.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_flow1" bpmnElement="flow1">
        <omgdi:waypoint xsi:type="omgdc:Point" x="117.0" y="115.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="122.0" y="560.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow2" bpmnElement="flow2">
        <omgdi:waypoint xsi:type="omgdc:Point" x="175.0" y="587.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="220.0" y="588.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_resolved" bpmnElement="resolved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="260.0" y="588.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="320.0" y="587.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="320.0" y="427.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="53.0" x="264.0" y="480.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_notResolved" bpmnElement="notResolved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="240.0" y="568.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="242.0" y="275.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="75.0" x="156.0" y="480.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow3" bpmnElement="flow3">
        <omgdi:waypoint xsi:type="omgdc:Point" x="340.0" y="407.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="370.0" y="407.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow4" bpmnElement="flow4">
        <omgdi:waypoint xsi:type="omgdc:Point" x="295.0" y="247.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="320.0" y="264.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="320.0" y="387.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow5" bpmnElement="flow5">
        <omgdi:waypoint xsi:type="omgdc:Point" x="475.0" y="407.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="520.0" y="408.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_disapproved" bpmnElement="disapproved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="540.0" y="388.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="539.0" y="247.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="295.0" y="247.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="74.0" x="456.0" y="288.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow6" bpmnElement="flow6">
        <omgdi:waypoint xsi:type="omgdc:Point" x="595.0" y="588.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="640.0" y="588.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_approved" bpmnElement="approved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="540.0" y="428.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="542.0" y="561.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="57.0" x="474.0" y="456.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>