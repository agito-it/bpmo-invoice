<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd" targetNamespace="http://www.activiti.org/test">
  <collaboration id="Collaboration">
    <participant id="InvoicePool" name="Invoice pool" processRef="Invoice_InvoiceProcess"/>
  </collaboration>
  <process id="Invoice_InvoiceProcess" name="Invoice" isExecutable="true">
    <laneSet id="laneSet_Invoice_InvoiceProcess">
      <lane id="postOffice" name="Mail Admin Center">
        <flowNodeRef>startevent</flowNodeRef>
        <flowNodeRef>orderResolvedGateway</flowNodeRef>
        <flowNodeRef>ResolveOrder</flowNodeRef>
      </lane>
      <lane id="accounting" name="Financial Accounting">
        <flowNodeRef>CheckOrder</flowNodeRef>
      </lane>
      <lane id="approval" name="Approver">
        <flowNodeRef>exclusivegateway1</flowNodeRef>
        <flowNodeRef>Approval</flowNodeRef>
        <flowNodeRef>endevent</flowNodeRef>
        <flowNodeRef>approvalGateway</flowNodeRef>
        <flowNodeRef>Transfer</flowNodeRef>
      </lane>
    </laneSet>
    <startEvent id="startevent" name="Start">
      <outgoing>flow1</outgoing>
    </startEvent>
    <serviceTask id="ResolveOrder" activiti:async="true" activiti:exclusive="false" activiti:class="de.agito.cps.process.camunda.listener.ExecuteBPMOActionDelegate" name="Resolve Order">
      <extensionElements>
        <activiti:field name="action">
          <activiti:string>ResolveOrder</activiti:string>
        </activiti:field>
        <activiti:field name="variable">
          <activiti:string>IsResolved</activiti:string>
        </activiti:field>
        <activiti:field name="mode">
          <activiti:string>EDIT</activiti:string>
        </activiti:field>
      </extensionElements>
      <incoming>flow1</incoming>
      <outgoing>flow2</outgoing>
    </serviceTask>
    <sequenceFlow id="flow1" sourceRef="startevent" targetRef="ResolveOrder"/>
    <exclusiveGateway id="orderResolvedGateway" name="" default="notResolved">
      <incoming>flow2</incoming>
      <outgoing>notResolved</outgoing>
      <outgoing>resolved</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="flow2" sourceRef="ResolveOrder" targetRef="orderResolvedGateway"/>
    <sequenceFlow id="notResolved" name="Not resolved" sourceRef="orderResolvedGateway" targetRef="CheckOrder"/>
    <exclusiveGateway id="exclusivegateway1" name="">
      <incoming>flow4</incoming>
      <incoming>resolved</incoming>
      <outgoing>flow5</outgoing>
    </exclusiveGateway>
    <userTask id="Approval" activiti:candidateUsers="${approver},${$cpsInitiator}" name="Approve invoice">
      <incoming>flow5</incoming>
      <outgoing>flow7</outgoing>
    </userTask>
    <sequenceFlow id="flow5" sourceRef="exclusivegateway1" targetRef="Approval">
      <extensionElements>
        <activiti:executionListener class="de.agito.cps.process.camunda.listener.ExecuteBPMOActionListener" event="take">
          <activiti:field name="action">
            <activiti:string>GetApprover</activiti:string>
          </activiti:field>
          <activiti:field name="variable">
            <activiti:string>approver</activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="resolved" name="Order resolved" sourceRef="orderResolvedGateway" targetRef="exclusivegateway1">
      <conditionExpression xsi:type="tFormalExpression">${IsResolved}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow7" sourceRef="Approval" targetRef="approvalGateway"/>
    <sequenceFlow id="disapproved" name="desclined" sourceRef="approvalGateway" targetRef="CheckOrder"/>
    <serviceTask id="Transfer" activiti:async="true" activiti:exclusive="false" activiti:class="de.agito.cps.process.camunda.listener.ExecuteBPMOActionDelegate" name="Transfer to ERP">
      <extensionElements>
        <activiti:field name="action">
          <activiti:string>BackendBooking</activiti:string>
        </activiti:field>
      </extensionElements>
      <incoming>approved</incoming>
      <outgoing>flow10</outgoing>
    </serviceTask>
    <sequenceFlow id="approved" name="approved" sourceRef="approvalGateway" targetRef="Transfer">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${$cpsChoiceIdApproval.equals("approved")}]]></conditionExpression>
    </sequenceFlow>
    <endEvent id="endevent" name="">
      <incoming>flow10</incoming>
    </endEvent>
    <sequenceFlow id="flow10" sourceRef="Transfer" targetRef="endevent"/>
    <exclusiveGateway id="approvalGateway" name="" default="disapproved">
      <incoming>flow7</incoming>
      <outgoing>disapproved</outgoing>
      <outgoing>approved</outgoing>
    </exclusiveGateway>
    <userTask id="CheckOrder" activiti:candidateGroups="roleAnyone" name="Check order">
      <incoming>notResolved</incoming>
      <incoming>disapproved</incoming>
      <outgoing>flow4</outgoing>
    </userTask>
    <sequenceFlow id="flow4" sourceRef="CheckOrder" targetRef="exclusivegateway1"/>
    <textAnnotation id="textannotation1">
      <text>Update record in a ERP system by using an specialized interface</text>
    </textAnnotation>
    <association id="association1" sourceRef="textannotation1" targetRef="Transfer"/>
    <textAnnotation id="textannotation2">
      <text>Resolve order information from ERP System</text>
    </textAnnotation>
    <association id="association2" sourceRef="textannotation2" targetRef="ResolveOrder"/>
    <association id="association4" sourceRef="textannotation1" targetRef="Transfer"/>
    <association id="Association_1" sourceRef="orderResolvedGateway" targetRef="textannotation2"/>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_Collaboration">
    <bpmndi:BPMNPlane id="BPMNPlane_Collaboration" bpmnElement="Collaboration">
      <bpmndi:BPMNShape id="BPMNShape_InvoicePool" bpmnElement="InvoicePool" isHorizontal="false">
        <omgdc:Bounds height="492.0" width="991.0" x="20.0" y="10.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_postOffice" bpmnElement="postOffice" isHorizontal="false">
        <omgdc:Bounds height="157.0" width="971.0" x="40.0" y="10.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_accounting" bpmnElement="accounting" isHorizontal="false">
        <omgdc:Bounds height="156.0" width="971.0" x="40.0" y="167.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_approval" bpmnElement="approval" isHorizontal="false">
        <omgdc:Bounds height="176.0" width="971.0" x="40.0" y="323.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_startevent" bpmnElement="startevent">
        <omgdc:Bounds height="35.0" width="35.0" x="70.0" y="89.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_resolveOrder" bpmnElement="ResolveOrder">
        <omgdc:Bounds height="55.0" width="105.0" x="140.0" y="79.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_orderResolvedGateway" bpmnElement="orderResolvedGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="309.0" y="86.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_CheckOrder" bpmnElement="CheckOrder">
        <omgdc:Bounds height="55.0" width="105.0" x="276.0" y="204.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_exclusivegateway1" bpmnElement="exclusivegateway1">
        <omgdc:Bounds height="40.0" width="40.0" x="390.0" y="364.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_Approval" bpmnElement="Approval">
        <omgdc:Bounds height="55.0" width="105.0" x="470.0" y="357.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_transfer" bpmnElement="Transfer">
        <omgdc:Bounds height="55.0" width="105.0" x="740.0" y="357.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_endevent" bpmnElement="endevent">
        <omgdc:Bounds height="35.0" width="35.0" x="900.0" y="367.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_approvalGateway" bpmnElement="approvalGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="640.0" y="364.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_textannotation1" bpmnElement="textannotation1">
        <omgdc:Bounds height="55.0" width="141.0" x="860.0" y="411.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_textannotation2" bpmnElement="textannotation2">
        <omgdc:Bounds height="50.0" width="161.0" x="309.0" y="24.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_flow1" bpmnElement="flow1">
        <omgdi:waypoint xsi:type="omgdc:Point" x="105.0" y="106.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="140.0" y="106.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow2" bpmnElement="flow2">
        <omgdi:waypoint xsi:type="omgdc:Point" x="245.0" y="106.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="309.0" y="106.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_notResolved" bpmnElement="notResolved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="329.0" y="126.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="328.0" y="204.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="77.0" x="252.0" y="133.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow4" bpmnElement="flow4">
        <omgdi:waypoint xsi:type="omgdc:Point" x="328.0" y="258.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="328.0" y="384.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="390.0" y="384.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="0.0" width="0.0" x="328.0" y="359.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow5" bpmnElement="flow5">
        <omgdi:waypoint xsi:type="omgdc:Point" x="430.0" y="384.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="470.0" y="384.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_resolved" bpmnElement="resolved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="349.0" y="106.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="410.0" y="106.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="410.0" y="364.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="89.0" x="372.0" y="86.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow7" bpmnElement="flow7">
        <omgdi:waypoint xsi:type="omgdc:Point" x="575.0" y="384.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="640.0" y="384.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_disapproved" bpmnElement="disapproved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="660.0" y="404.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="660.0" y="465.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="223.0" y="465.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="223.0" y="231.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="276.0" y="231.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="57.0" x="672.0" y="432.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_approved" bpmnElement="approved">
        <omgdi:waypoint xsi:type="omgdc:Point" x="680.0" y="384.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="740.0" y="384.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="22.0" width="57.0" x="680.0" y="357.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_flow10" bpmnElement="flow10">
        <omgdi:waypoint xsi:type="omgdc:Point" x="845.0" y="384.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="900.0" y="384.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_association4" bpmnElement="association4">
        <omgdi:waypoint xsi:type="omgdc:Point" x="860.0" y="438.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="792.0" y="412.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_Association_1" bpmnElement="Association_1" sourceElement="BPMNShape_orderResolvedGateway" targetElement="BPMNShape_textannotation2">
        <omgdi:waypoint xsi:type="omgdc:Point" x="349.0" y="87.0"/>
        <omgdi:waypoint xsi:type="omgdc:Point" x="363.0" y="74.0"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>